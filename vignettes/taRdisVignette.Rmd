---
title: "taRdis"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{taRdis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
taRdis is an R package designed to normalize, analyze, and plot measurements collected over distance and time. It is designed specifically to operate on output from the image processing program **ImageJ's "plot profile" function**, which generates a series of distance markers along a region of interest on an image (specified in ImageJ) and corresponding fluorescence intensity readings at those markers. 

taRdis is designed to analyze fluorescence intensity measurements taken for the same region of interest at multiple time points by subtracting a background fluorescence value from all data points, computing the average fluorescence intensity for the full time series at each distance marker in the region of interest, and plotting the resulting Average Fluorescence Intensity vs Distance on a scatterplot. 

This example will demonstrate the workflow of the three taRdis functions (**backtract**, **AverageJ**, and **mid2**) with a sample dataset. These functions are designed to be applied sequentially to a raw dataset, but this workflow is not required. 
```{r setup}
library(taRdis)
```
## Data Structure (Example)
A sample dataset shows fluorescence readings at three different timepoints for a region of interest with a distance of four. 
```{r}
print(taRdis_SampleData)
```
For the functions **backtract** and **AverageJ**, the user will need to supply the number of distance markers for the argument **spatialPoints** and the number of time points for the argument **timePoints**.

The sample dataset has **spatialPoints** = 4 (four entries in the first column "Distance") and **timePoints** = 3 (three time point column entries to the right of "Distance").

## backtract
The first function, **backtract**, normalizes the fluorescence data by subtracting a single background fluorescence from each data point. 

The value to be subtracted is measured by the user in another program like ImageJ and specified in the  backtract argument **background**. For this example, **background** = 1. 
```{r}
backtractExample <- backtract(taRdis_SampleData, background = 1, spatialPoints = 4, timePoints = 3)

print(backtractExample)
```
All measurements at every distance marker and every time point have now been reduced by exactly 1.The data is now normalized. 

## AverageJ 
The second function, **AverageJ**, operates on the normalized dataset produced by **backtract**. For each distance marker in the column "Distance," AverageJ computes the average fluorescence intensity reading across all time points. 

For example, for just the distance marker Distance = 0, AverageJ will compute the average of the values 80, 46, 149.
```{r}
#The measurements to be averaged
print(backtractExample[1, ])

#AverageJ computes the average of these values at distance marker 0
Example <- AverageJ(backtractExample[1, ], spatialPoints = 1, timePoints = 3)
print(Example)
```
This calculation is repeated for all distance markers. A 2-column matrix is generated containing the distance markers ("Distance") and the average fluorescence values corresponding to each distance marker ("Average Fluorescence"). 
```{r}
AverageJExample <- AverageJ(backtractExample, spatialPoints = 4, timePoints = 3)
print(AverageJExample)
```
## mid2
The final function, **mid2**, generates a pre-formatted scatterplot displaying **Average Fluorescence Intensity vs Distance (pixels)**. The axis labels, line type, and color are all pre-set by the function. 

This function plots the two-column matrix generated by AverageJ. 
```{r}
Scatterplot <- mid2(AverageJExample)
```


Users who wish to use different line types, colors, or axis labels, or who wish to otherwise customize their scatterplots may produce graphs to their own specifications using the "matplot" function in base R using the same output from AverageJ. 
